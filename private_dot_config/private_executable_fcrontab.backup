#!/bin/sh

# Sync Local
@ 720 . $HOME/.zshenv; promnesia index
# @ 30 . $HOME/.zshenv; calcurse -x > $HOME/.local/share/calendars/main/main.ics # GNOME & KDE

## Sync Servers
@ 05 . $HOME/.zshenv; vdirsyncer sync ; date &>/tmp/cron-vdirsyncer.log
@ 05 . $HOME/.zshenv; $HOME/.local/bin/scripts/bukuding ; date &>/tmp/cron-bukuding.log
@ 15 . $HOME/.zshenv; $HOME/.local/bin/scripts/syncmail ; date &>/tmp/cron-syncmail.log
# @ 30 . $HOME/.zshenv; $HOME/.local/bin/scripts/synctodo; vdirsyncer sync ; date &>/tmp/cron-todo-sync.log
# @ 30 . $HOME/.zshenv; $HOME/.local/bin/scripts/syncbuku ; date &>/tmp/cron-buku-sync.log
# @ 30 . $HOME/.zshenv; $HOME/.local/bin/scripts/syncalendar ; date &>/tmp/cron-calcurse.log

## Local Imports
@ 1d . $HOME/.zshenv; tree-index-md $ZET_DIR > $ZET_DIR/000-index.md
@ 1d . $HOME/.zshenv; python -m hypexport.export --secrets $HOME/.config/hypothesis/secrets.py > $ZET_DIR/hyp-annotations.json
@ 1d . $HOME/.zshenv; python -m orger.modules.hypothesis --to $ZET_DIR/hyp-annotations.org
@ 1d . $HOME/.zshenv; torsimany $ZET_DIR/hyp-annotations.json

## Local Backups
@ 1d . $HOME/.zshenv; merge-mpv-data
@ 1d . $HOME/.zshenv; \
	browserexport save --profile sx15jrar.User.js -b firefox --to $HPIDATA/Browser ; \
	browserexport merge --json $HPIDATA/Browser/*.sqlite > $HPIDATA/Browser/firefox-history.json ; \
	merge-browser-history
@ 1d . $HOME/.zshenv; rsync $HOME/.local/share/buku/bookmarks.db $HOME/Backups/Data/Bookmarks
@ 1d . $HOME/.zshenv; rsync $HOME/.local/share/buku/firefox-bookmarks.db $HOME/Backups/Data/Bookmarks
@ 1d . $HOME/.zshenv; rsync -a $HOME/.local/share/mail/* $HOME/Backups/Data/Mail
@ 1d . $HOME/.zshenv; rsync -a $HOME/.local/share/calendars/* $HOME/Backups/Data/Calendars
@ 1d . $HOME/.zshenv; rsync -a $HOME/.local/share/contacts/* $HOME/Backups/Data/Contacts
@ 1d . $HOME/.zshenv; rsync -a $HOME/.local/share/passwords/* $HPIDATA/Passwords
@ 1d . $HOME/.zshenv; rsync $HOME/.local/share/mopidy/advanced_scrobbler/advanced_scrobbler.db $HPIDATA/Music
@ 1d . $HOME/.zshenv; python $HOME/.local/bin/scripts/todo2org.py $TODO_FILE
@ 1d . $HOME/.zshenv; python $HOME/.local/bin/scripts/todo2org.py $TODO_FILE --reverse
@ 1d . $HOME/.zshenv; python $HOME/.local/bin/scripts/todo2org.py $DONE_FILE
@ 1d . $HOME/.zshenv; python $HOME/.local/bin/scripts/todo2org.py $DONE_FILE --reverse
@ 1d . $HOME/.zshenv; jrnl --config-override journals.default $DEFAULT_JRNL --format md > $GTD_DIR/Journal.md
@ 1w . $HOME/.zshenv; wget http://localhost:5600/api/0/export -O $HPIDATA/ActivityWatch/export.json

## Git Backups
@ 05 . $HOME/.zshenv; cd $ZET_DIR; $HOME/.local/bin/scripts/autogit
@ 05 . $HOME/.zshenv; cd $GTD_DIR; $HOME/.local/bin/scripts/autogit
@ 60 . $HOME/.pam_environment; . $HOME/.zshenv; chezmoi add --encrypt $HOME/.cache/zsh

# Daily Feed
@ 60 newsboat --url-file=$HOME/.config/newsboat/daily-list -x reload print-unread --cache-file=$HOME/.local/share/newsboat/daily-cache.db | awk '{print $1;}' > $HOME/.config/newsboat/today-unread-count
# @ 60 sfeed_update $HOME/.config/sfeed/sfeedrc-daily ; date $>/tmp/cron-sfeed-daily.log
# @ 60 sfeed_html $HOME/.local/share/sfeed/feeds-daily/* > $HOME/.local/share/sfeed/feeds-daily.html
# @ 60 sfeed_plain $HOME/.local/share/sfeed/feeds-daily/* > $HOME/.local/share/sfeed/feeds-daily.txt

# Total Feed
%hours * 06-09,21-00 * * * newsboat --url-file=$HOME/.config/newsboat/urls -x reload
# %hours * 06-09,21-00 * * * sfeed_update $HOME/.config/sfeed/sfeedrc ; date $>/tmp/cron-sfeed.log
# %hours * 06-09,21-00 * * * sfeed_html $HOME/.local/share/sfeed/feeds/* > $HOME/.local/share/sfeed/feeds.html
# %hours * 06-09,21-00 * * * sfeed_plain $HOME/.local/share/sfeed/feeds/* > $HOME/.local/share/sfeed/feeds.txt

# Cleanup
@ 1d rm $HOME/.bg
@ 1d rm $HOME/.yarnrc
@ 1d rm $HOME/package.json
@ 1d rm $HOME/package-lock.json
@ 1d rm $HOME/.autotiling.bolt
@ 1d rm -rf $HOME/.npm
@ 1d rm -rf $HOME/node_modules
@ 1d rm -rf $HOME/.node-gyp
@ 1d rm -rf $HOME/.electron
@ 1d rm -rf $HOME/.electron-gyp
@ 1d rm -rf $HOME/.nuget
@ 1d rm -rf $HOME/.dotnet
@ 1d rm -rf $HOME/.pki
@ 1d rm -rf $HOME/.vscode-oss

# Backup
@ 1d dconf dump / > $HOME/.config/saved_settings.dconf

# Notifications
@ 20160 notify-send "Upgrade system"
@ 20160 notify-send "Clear caches"
